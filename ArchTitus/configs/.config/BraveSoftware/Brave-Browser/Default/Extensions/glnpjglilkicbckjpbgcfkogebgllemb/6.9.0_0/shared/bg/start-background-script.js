Okta.startBackgroundScript=function(a,i,u,d){var g=1e3,o=Okta.Q.when,c=Okta.fn.storage.wrapVal,p=Okta.fn.base.timestamp,r=Okta.fn.api.getToSettings,l=Okta.fn.api.prependPath,k=Okta.fn.api.setSessionData,e=Okta._okta,y=e.first,P=e.filter,f=e.isUndefined,T=Okta.Q;function b(e){return"_lock_"+e}function v(){return f(a.isInstalledByUser)?T(!0):a.isInstalledByUser()}function n(e,t,s,o){switch(e){case"getSessionState":return i.get(s.key);case"setSessionState":return i.set(s.key,s.val);case"getPersistentState":return u.get(s.key);case"setPersistentState":return u.set(s.key,s.val);case"clearPersistentState":return u.clear&&u.clear(),s.result=!0,s.browserType=a.getType(),s;case"requestPrivacyPermissions":return f(a.requestPrivacyPermissions)?T({errorCode:"requestPrivacyPermissions is not supported on "+a.getType()}):a.requestPrivacyPermissions();case"getTabId":return t;case"documentLoaded":return f(a.documentLoaded)?T({errorCode:"not supported by this version of the plugin"}):a.documentLoaded(t,o);case"getBrowserType":return a.getType();case"getBackgroundVersion":return a.getBackgroundVersion();case"unlockSessionKey":return function n(e){return i.set(b(e),null),!0}(s.key);case"lockSessionKey":return function r(e){var t=p(),s=b(e),o=i.get(s);return(!o||t>o.lockTime+g)&&(i.set(s,{lockTime:t}),!0)}(s.key);case"request":return d.ajax(s);case"openTab":return a.openTab(s.url);case"hasPrivacyPermissions":return a.hasPrivacyPermissions?a.hasPrivacyPermissions():T(c(!0));case"openPermissionsPage":return a.openPermissionsPage?a.openPermissionsPage():T({errorCode:"openPermissionsPage is not supported on "+a.getType()});case"openSettingsPage":return a.openSettingsPage?a.openSettingsPage():T({errorCode:"openSettingsPage is not supported on "+a.getType()});case"openOktaNewtab":return a.openOktaNewtab?a.openOktaNewtab():T({errorCode:"openOktaNewtab is not supported on "+a.getType()});case"servePopover":return a.servePopover?a.servePopover():T({errorCode:"servePopover is not supported on "+a.getType()});case"suppressSavePassword":return a.suppressSavePassword?a.suppressSavePassword(t,s):T({errorCode:"suppressSavePassword is not supported on "+a.getType()});case"getPasswordSavingDetails":return a.getPasswordSavingDetails?a.getPasswordSavingDetails():T({errorCode:"getPasswordSavingDetails is not supported on "+a.getType()});case"openTabForAccountChooser":return f(a.openTabForAccountChooser)?T({errorCode:"not supported by this version of the plugin",url:s.url}):a.openTabForAccountChooser(s.url);case"closeTab":return a.closeTab(t);case"getCookies":return f(a.getCookies)?T({errorCode:"not supported by this version of the plugin"}):a.getCookies(s.key.hostUrl,s.key.cookieNames,t);case"getLocalStorageUsage":return f(a.getLocalStorageUsage)?T({errorCode:"not supported by this version of the plugin"}):a.getLocalStorageUsage().fail(function(e){return T({errorCode:"failed to get the local storage usage: "+e})});case"updateBadge":return f(a.updateBadge)?T.resolve():a.updateBadge(s.key);case"downloadExtensionLogs":return f(a.downloadExtensionLogs)?T.resolve():a.downloadExtensionLogs(s.key);case"setUninstallURL":return f(a.setUninstallURL)?T.resolve():a.setUninstallURL(s.url||"");case"isInstalledByUser":return v();case"injectContentScript":return a.injectContentScript&&a.injectContentScript(t,o),T();case"getSessionTabState":return i.get(s.key+"_"+t);case"sendMsgToCurrentTab":return f(a.sendMsgToCurrentTab)?T({errorCode:"sendMsgToCurrentTab not supported on "+a.getType()}):a.sendMsgToCurrentTab(s);default:return T({errorCode:"Unknown msg type: "+e})}}function h(e){u.set("PENDO_ONBOARDING_DATA",c({sentTo:e,timestamp:p()}))}a.on("injectReady",function(e){a.injectScript(e,null)}),a.on("messageFromContent",function(t){var s=t.msg,e=n(s.type,t.tabId,s.data,t.frameId);o(e,function(e){a.post({msg:{id:s.id,type:s.type,data:e},tabId:t.tabId,portInfo:t.portInfo})}).done()}),a.on("postInstall",function(){return u.set("ONBOARDING_FLOW",c(!0)),v().then(function(e){return Okta.Config.onboardingLaunchNewTab&&e?a.getOrgsWithSessionCookies():T(null)}).then(function(e){if(e)if(e.oktaAccounts&&0!==e.oktaAccounts.length){var t=1===e.oktaAccounts.length;if(!e.sessions||0===e.sessions.length)return a.openTab(t?y(e.oktaAccounts).origin+"/login/login.htm":"https://login.okta.com"),void h(t?"orgLogin":"oktaLogin");var s=P(e.sessions,function(e){return e.tabId!==undefined});if(!t&&0===s.length)return a.openTab("https://login.okta.com"),void h("oktaLogin");var o=y(t?e.sessions:s),n=r(o.domain+l("/settings"),{backgroundVersion:a.getBackgroundVersion(),contentVersion:""});k({sid:o.sid,DT:o.dt,idx:o.idx},n.headers),d.ajax(n).then(function(e){e?(u.set("PLUGIN_SETTINGS",c({override:{},orgSettings:e})),e.pluginOnboardingEnabled?o.tabId!==undefined&&o.isDashboardTab?(a.highlightAndRefreshTab(o.tabId),h("refreshDashboard")):(a.openTab(o.domain+"/app/UserHome"),h("openDashboard")):h("none")):h("none")})}else h("zeroOrgs")})})};