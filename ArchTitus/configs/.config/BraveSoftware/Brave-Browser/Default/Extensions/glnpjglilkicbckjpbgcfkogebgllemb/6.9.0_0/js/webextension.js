Okta.WebExtension=function(n,e,t){var r=PLUGIN_VERSIONS.currentVersion;var a=Okta._okta;var i=a.delay;var s=a.extend;var o=Okta.Q;var u=Okta.Constants.StorageOktaAccountAllowListKey;var d=Okta.fn.updateBadge;var c=Okta.Events;var g=s({},c);var l=Okta.fn.base.curry2;var v=Okta.fn.base.always;var f=Okta.fn.url.getMonitoredSitesApiMatchPatterns;var p=75;var b=Okta.fn.script;var h=Okta.fn.cookies.getCookies;var w=Okta.fn.browserType;var k=w.isSafari(t);var m=w.isSafariWebExt(t);var O=w.isFirefox(t);var P=w.isChrome(t);var S=new Okta.AuthenticationMonitor(n,e);var T=new Okta.SuppressPwdSave;var C=new Okta.MyPagesMenu(n);var I=new Okta.Onboarding(t);var L=new Okta.Tabs(t);var M=new Okta.BasicAuth(n,e);var y=new Okta.RequestHeaders(r);var A=l(z);var U=chrome.runtime.onConnect;var N=chrome.runtime.onInstalled;var B=chrome.webRequest.onCompleted;var D=chrome.tabs.onCreated;var R=1e3;function E(e){return/^http/.test(e)}function x(e){var t=e.tabId;var n=e.frameId;if(n==0){T.deleteSuppressTab(t,true)}if(!E(e.url)){console.log("Skipped url: "+e.url);return}return L.getTab(t).then(function e(t){if(!t||!E(t.url)){return}b.injectPreloadScript(t.id,n)})}function z(e,t){g.trigger("messageFromContent",{msg:t,tabId:e.sender&&e.sender.tab?e.sender.tab.id:-1,frameId:e.sender?e.sender.frameId:0,portInfo:{port:e}})}function F(){i(function(){S.initialize()},R)}function q(){if(O){return window&&window.navigator&&window.navigator.userAgent&&parseInt(window.navigator.userAgent.toLowerCase().split("firefox/").pop())>=p}return!k&&!m}g.getType=v(t);g.getBackgroundVersion=v(r);g.post=function e(t){if(!t.portInfo.port.isDisconnected){t.portInfo.port.postMessage(t.msg)}};g.injectContentScript=b.injectContentScript;g.openTab=L.openTab;g.sendMsgToCurrentTab=L.sendMsgToCurrentTab;g.openTabForAccountChooser=L.openTabForAccountChooser;g.openPermissionsPage=L.openPermissionsPage;g.openOktaNewtab=L.openOktaNewtab;g.servePopover=L.servePopover;g.closeTab=L.closeTab;g.highlightAndRefreshTab=L.highlightAndRefreshTab;g.openSettingsPage=L.openSettingsPage;g.getCookies=h;g.isInstalledByUser=I.isInstalledByUser;g.getOrgsWithSessionCookies=I.getOrgsWithSessionCookies;g.setUninstallURL=I.setUninstallURL;g.updateBadge=d;g.getLocalStorageUsage=n.getStorageUsage;chrome.webNavigation.onDOMContentLoaded.addListener(x);U.addListener(function e(t){t.onMessage.addListener(A(t));t.onDisconnect.addListener(function(){t.isDisconnected=true})});N&&N.addListener(function(e){var t=e&&e.reason;if(t!=="install"){return}g.trigger("postInstall")});B&&B.addListener(F,{urls:f(),types:["xmlhttprequest"]});D&&D.addListener(function(a){return o.all([n.getDBGPluginSettings(),n.getNewTab()]).spread(function(e,t){var n=e&&e.NTEFlag;var r=t&&t.enableNTE;if(P&&n&&r&&a.pendingUrl==="chrome://newtab/"){chrome.tabs.update({url:chrome.runtime.getURL("shared/newtab/Newtab.html")})}})});if(!!q()){g.suppressSavePassword=T.turnOffSavePasswordFeature;g.hasPrivacyPermissions=T.hasPrivacyPermissions;g.getPasswordSavingDetails=T.getPasswordSavingDetails;g.requestPrivacyPermissions=T.requestPrivacyPermissions}g.showMyPagesMenu=function(e){e?C.createMenu():C.destroyMenu()};n.readMultiAccount();chrome.storage.onChanged.addListener(function(e,t){if(t!=="local"){return}if(e["DBG_PLUGIN_SETTINGS"]||e[u]){return n.readMultiAccount()}});S.initialize(false);C.initializeMenu();T.initialize();M.initialize(t);y.initialize();return g};