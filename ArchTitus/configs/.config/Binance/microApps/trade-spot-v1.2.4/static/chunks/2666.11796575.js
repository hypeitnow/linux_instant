(self["webpackJsonp_trade-spot"]=self["webpackJsonp_trade-spot"]||[]).push([[2666],{fLwl:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>F});var a=r("/SIk"),o=r.n(a),n=r("GuU3"),s=r.n(n),i=r("vs24"),c=r("h+sK"),l=r("ErMs"),u=r("VDrE"),d=r("xRsZ"),m=r("S24M"),y=r("U0yl"),g=r("IPgU"),p=r("9mqn"),h=r("LgBl"),b=r("WBfh"),T=r("Ekp3"),k=r("Ozc/"),S=r("mE5e");var E=r("lXyA"),_=r.n(E),C=r("ArXb"),f=r("3k2H"),v=r("b4Bg"),w=r("+WBH"),R=r("EHEI"),I=r("Sav6");const M="tv_web_error",B=(0,g.l6)(),L={1:"1m",3:"3m",5:"5m",15:"15m",30:"30m",60:"1h",120:"2h",240:"4h",360:"6h",480:"8h",720:"12h","1D":"1d","3D":"3d","1W":"1w","1M":"1M"},x=({namespace:e,useMiniTicker:t=!1})=>{const r=(0,a.useMemo)((()=>_()((()=>(0,f.Os)({eventId:"trd_chart_tv_load_timeout",stepId:"getBarsStart",catch({error:e,track:t}){t({GET_BAR_START_TYPE:e}),t({type:`GET_BAR_START_TYPE_${e}`})},log({track:e}){e({GET_BAR_START_TYPE:"SUCCESS"})}})))),[]),o=(0,a.useMemo)((()=>_()((()=>(0,f.Os)({eventId:"trd_chart_tv_load_timeout",stepId:"getBarsEnd",catch({error:e,track:t}){t({GET_BAR_END_TYPE:e}),t({type:`GET_BAR_END_TYPE_${e}`})},log({track:e}){e({GET_BAR_END_TYPE:"SUCCESS"})}})))),[]),{getI18n:n}=(0,d.ZK)(),[s]=(0,d.uT)(),i=(0,a.useRef)(""),c=(0,d.AM)(),u=(0,a.useRef)(c),y=(0,d._n)(),g=(0,a.useRef)(y),p=(0,a.useRef)(),[,T,k]=(0,h.Nj)(e)(b.kp);u.current=c,g.current=y;const S=(0,a.useMemo)((()=>n("trd-layout-spot",{defaultValue:"Spot"})||""),[n]),E=(0,a.useMemo)((()=>({exchanges:[{name:"Binance",value:"Binance",desc:""}],symbols_types:[{name:S,value:"Spot"}]})),[S]),x=(0,a.useCallback)((async e=>{var t;if(k(),null===(t=p.current)||void 0===t||t.call(p),!g.current)return;const r=await(({accountType:e,symbol:t})=>(0,I.lz)({accountType:e,startTime:Date.now()-7776e6,endTime:Date.now(),symbol:t}))({accountType:(0,f.lx)(s),symbol:e});T(r.map((e=>({id:e.orderId.toString(),avgPrice:+e.executedPrice,executedQty:+e.executedQty,side:e.side,time:e.updateTime,status:e.status,statusCode:e.statusCode})))),p.current=B.getUserOrderStream(s).subscribe((t=>{t.symbol===e&&T([{id:t.orderId.toString(),avgPrice:t.lastPrice||t.price,executedQty:t.cumulativeFilledQuantity,side:t.side,time:t.transactionTime,status:t.orderStatus,statusCode:h.GL.Unknown}])}))}),[T,k,s]);(0,C.Z)((()=>{x(i.current)}),[x]);const O=(0,a.useCallback)((e=>{i.current=e,x(e)}),[x]),V=(0,a.useCallback)((async()=>{try{await(0,f.YY)({checker:()=>Object.keys(u.current).length>0})}catch(t){(0,m.j)(M,{type:"onFetchSymbolsInfo",message:t.message})}const e=u.current;return Object.keys(e).reduce(((t,r)=>{const{symbol:a="",symbolDisplay:o="",tickSize:n=""}=e[r]||{};return t[r]={name:o,fullName:a,ticker:a,tickSize:+n,description:"",exchange:"Binance",supportedResolutions:l.k.DefaultResolutions,type:"Spot"},t}),{})}),[]),A=(0,a.useCallback)((async({symbolInfo:e,resolution:t,rangeStartDate:a,rangeEndDate:n})=>{r();const s=e.ticker||"",i=Math.max(0,1e3*a),c=1e3*n,l=L[t],u=(0,I.b0)({symbol:s,interval:l}),d=await(0,R.M)({onFetchKlineData:u,startTime:i,endTime:c});return o(),d}),[o,r]),D=(0,a.useCallback)((({symbolInfo:e,resolution:r,callback:a})=>{const o=e.ticker||"",n=L[r];return(0,w.Ld)({symbol:o,interval:n,useMiniTicker:t,checkIfInSync:()=>!0,callback:e=>a(e)})}),[t]),P=(0,a.useCallback)((async()=>{const{serverTime:e}=await(0,v.b)();return Math.floor(parseInt(e,10)/1e3)}),[]),{datafeed:N}=l.k.createDatafeed({config:E,onFetchSymbolsInfo:V,onFetchBars:A,onSubscribeBars:D,onFetchServerTimeApi:P});return{datafeed:N,onSymbolWillChange:O}},O="trd_chart_tv_load_timeout",V=()=>{(0,f.Os)({eventId:O,stepId:"chartResponsive",catch({error:e,track:t}){t({CHART_RESPONSIVE_TYPE:e,connection:JSON.stringify(navigator.connection)}),t({type:`CHART_RESPONSIVE_TYPE_${e}`})},log({track:e}){e({CHART_RESPONSIVE_TYPE:"SUCCESS"})}})};var A=o().createElement;const D="myTradingView",P=e=>{[p.P3].map((e=>s().createInstance({name:e}))).forEach((t=>t.setItem(D,e)))},N=({symbol:e,storage:t,namespace:r,useMiniTicker:o})=>{const[,n]=(0,h.TB)("")(b.F5),s=(0,a.useRef)(null),{datafeed:u,onSymbolWillChange:E}=x({namespace:r,useMiniTicker:o}),_=(0,d.Xw)(),{orderLines:C}=(({symbol:e,namespace:t})=>{const[r]=(0,h.iO)(t)(b.bm),o=(0,d.H3)({symbol:e});return{orderLines:(0,a.useMemo)((()=>r?o.map((e=>{const{orderId:t,quantity:r,price:a,text:o,isBuy:n,cancel:s}=e;return{id:t.toString(),text:o,price:+a,quantity:r,isBuy:n,tooltip:"",modifyTooltip:"",cancelTooltip:"",editable:!1,onMove:()=>null,onModify:()=>null,onCancel:s}})):[]),[o,r])}})({symbol:e,namespace:r}),{executionOrders:v}=(({symbol:e,namespace:t})=>{const[r]=(0,h.uh)(t)(b.wV),[o]=(0,h.Nj)(t)(b.kp),{getI18n:n}=(0,d.KL)(),s=(0,d.AM)()[e]||{},{tickSize:i,minQty:c}=s,l=(0,a.useMemo)((()=>n("openOrder-sideBuyBOTH",{defaultValue:"Buy"})||""),[n]),u=(0,a.useMemo)((()=>n("openOrder-sideSellBOTH",{defaultValue:"Sell"})||""),[n]),m=(0,a.useMemo)((()=>Math.abs(Math.log10(+(i||"0")))),[i]),y=(0,a.useMemo)((()=>Math.abs(Math.log10(+(c||"0")))),[c]),g=(0,a.useCallback)((({executedQty:e})=>(0,S.mD)(e,y)),[y]);return{executionOrders:(0,a.useMemo)((()=>r?o.filter((({status:e,statusCode:t,executedQty:r})=>"FILLED"===e.toUpperCase()||t===h.GL.Filled||"PARTIAL FILL"===e.toUpperCase()||t===h.GL.PartiallyFilled||"PARTIALLY_FILLED"===e.toUpperCase()||("EXPIRED"===e.toUpperCase()||t===h.GL.Expired)&&r>0||("CANCELED"===e.toUpperCase()||t===h.GL.Canceled)&&r>0)).map((({id:e,avgPrice:t,side:r,time:a,executedQty:o})=>{const n=`${"BUY"===r?l:u} ${g({executedQty:o})} @ ${t.toFixed(m)}`;return{id:e,text:"",price:t,quantity:"",time:Math.round(a/1e3),isBuy:"BUY"===r,tooltip:n}})):[]),[r,o,l,u,g,m])}})({symbol:e,namespace:r}),w=(0,h.Qy)(r)(b.VW),R=(0,h.H9)(r)(b.Hs),I=(0,h.v5)(r)(b.B3),[B]=(0,h.BD)(r)(b.cH),[L]=(0,h.OL)(r)(b.NB),N=(0,h.Nu)(r)(b.O3)===c.oX.Line?l.k.Dropdowns.ChartStyles.Line:L,F=p.nw[w],{isLight:Y,shouldResetTradingView:U,updateShouldResetTradingView:H}=(0,d.Fg)(),G=Y?"light":"dark",j=(0,T.k)(G),Q=(0,a.useMemo)((()=>`${r}-${p.P7}`),[r]),$=(0,d.tZ)(),Z=(0,p.GL)($),z=(0,a.useMemo)((()=>l.k.getTradingViewNextStyles(_)),[_]),J=(0,a.useCallback)((()=>t.getItem(D)),[t]),W=(0,a.useCallback)((e=>P(e)),[]),X=(0,a.useCallback)(I,[I]),q=(0,a.useCallback)((()=>{s.current&&n(s.current),(()=>{const e=(0,f.Nb)({id:"chartReady"}),t=(0,f.Nb)({id:"getBarsStart",timeout:3}),r=(0,f.Nb)({id:"getBarsEnd",timeout:6}),a=(0,f.Nb)({id:"chartResponsive",timeout:3}),o=f.Nb.auto({log:({track:e})=>{e((({duration:e})=>({type:"success",duration:(0,f.LU)(e,150)})))}});f.Os.init({eventId:O,step:e._(f.Nb.race(t._(r)._(a),a))._(o)}),(0,f.Os)({eventId:O,stepId:"chartReady",catch({error:e,track:t}){t({CHART_READY_TYPE:e,connection:JSON.stringify(navigator.connection)}),t({type:`CHART_READY_TYPE_${e}`})},log({track:e}){e({CHART_READY_TYPE:"SUCCESS",connection:JSON.stringify(navigator.connection)})}})})()}),[n]),K=(0,a.useCallback)((async()=>{const e=await t.getItem(D);P(e)}),[t]),ee=(0,a.useCallback)((e=>k.Z.log(JSON.stringify({type:"tv-error",error:e}),"custom")),[]),te=(0,a.useCallback)(V,[V]),re=(0,a.useCallback)((()=>{H(!1)}),[H]),{showError:ae,mainText:oe,buttonText:ne,buttonCallback:se,onScriptLoadingError:ie,onTradingViewInitError:ce,onChartReadyError:le}=(({storage:e})=>{const{getI18n:t}=(0,y.Z)(),r=(0,a.useMemo)((()=>t("trd-chart-tv-load-timeout",{defaultValue:"Failed to load TradingView due to network issues."})||""),[t]),o=(0,a.useMemo)((()=>t("trd-chart-tv-initialization-error",{defaultValue:"Something went wrong while initializing TradingView."})||""),[t]),n=(0,a.useMemo)((()=>t("trd-chart-crash-reload",{defaultValue:"Refresh"})||""),[t]),s=(0,a.useMemo)((()=>t("trd-chart-init-error",{defaultValue:"Failed to initialize TradingView due to malformed config, please try to refresh"})||""),[t]),i=(0,a.useCallback)((()=>window.location.reload()),[]),c=(0,a.useCallback)((async()=>{await e.removeItem("myTradingView"),i()}),[i,e]),{0:l,1:u}=(0,a.useState)(!1),{0:d,1:g}=(0,a.useState)(""),{0:p,1:h}=(0,a.useState)(""),b=(0,a.useRef)((()=>Promise.resolve())),T=(0,a.useCallback)((()=>{(0,m.j)("trd_chart_tv_download_timeout",{user_network:JSON.stringify(navigator.connection)}),(0,m.j)(M,{type:"onScriptLoadingError",message:""}),u(!0),g(r),h(n),b.current=i}),[r,n,i]),k=(0,a.useCallback)((e=>{(0,m.j)(M,{type:"onTradingViewInitError",message:e.message}),u(!0),g(s),h(n),b.current=c}),[c,n,s]),S=(0,a.useCallback)((e=>{(0,m.j)(M,{type:"onChartReadyError",message:e.message}),u(!0),g(o),h(n),b.current=i}),[o,n,i]);return{showError:l,mainText:d,buttonText:p,buttonCallback:b.current,onScriptLoadingError:T,onTradingViewInitError:k,onChartReadyError:S}})({storage:t});return ae?A(l.k.ChartFallback,{mainText:oe,btnText:ne,resetErrorBoundary:se}):A(i.Z,{sx:{height:"100%",display:R!==p.vm.tradingView?"none":"block"}},A(l.k.TradingViewNext,{symbol:e,interval:F,theme:j,styles:z,limitOrders:C,positionOrders:[],executionOrders:v,showIndicators:B,seriesStyle:N,overwritingThemeOnLoaded:U,operator:s,initialConfig:{tvConfig:{container_id:Q,library_path:`${g.Or}/charting_library_next/`,symbol:e,interval:F,theme:j,locale:Z,datafeed:u},onLoadConfig:J,onSave:W,onLoading:X,onChartReadyDone:q,onChartReadyError:le,onSymbolWillChange:E,onWillUnmount:K,onCreateOrderShapesError:ee,onScriptLoadingError:ie,onFirstTimeDataLoadedDone:te,onTradingViewInitError:ce,onSetThemeDone:re}}))},F=e=>{const{getI18n:t}=(0,y.Z)(),r=(0,a.useMemo)((()=>t("trd-chart-crash-info",{defaultValue:"Something is wrong with the chart."})||""),[t]),o=(0,a.useMemo)((()=>t("trd-chart-crash-refresh",{defaultValue:"Refresh"})||""),[t]),n=(0,a.useCallback)((()=>e.storage.removeItem("myTradingView")),[e.storage]),s=(0,a.useCallback)(((e,t)=>{k.Z.log(JSON.stringify({type:"trading_view",error:e,componentStack:t}),"custom")}),[]);return A(u.S,{name:"trading_view",FallbackComponent:({resetErrorBoundary:e})=>A(l.k.ChartFallback,{mainText:r,btnText:o,resetErrorBoundary:e}),onReset:n,onError:s,track:m.j},A(N,e))}}}]);